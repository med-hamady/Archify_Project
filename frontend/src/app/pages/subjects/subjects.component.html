<div class="subjects-container">
  <!-- Header -->
  <div class="header">
    <button class="back-btn" routerLink="/dashboard">← Tableau de bord</button>
    <h1>📚 Choisissez une matière</h1>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>Chargement des matières...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-message">
    <p>{{ error }}</p>
    <button class="btn btn-primary" (click)="loadSubjects()">Réessayer</button>
  </div>

  <!-- Subjects Grid -->
  <div *ngIf="!loading && !error" class="subjects-grid">
    <div
      *ngFor="let subject of subjects"
      class="subject-card"
      [class]="getProgressClass(subject.progressPercent)">

      <!-- Subject Header -->
      <div class="subject-header">
        <h2>{{ subject.title }}</h2>
        <span class="semester-badge">{{ subject.semester }}</span>
      </div>

      <!-- Progress Bar -->
      <div class="progress-section">
        <div class="progress-label">
          <span>Progression</span>
          <span class="progress-percent">{{ (subject.progressPercent || 0).toFixed(0) }}%</span>
        </div>
        <div class="progress-bar">
          <div
            class="progress-fill"
            [style.width.%]="subject.progressPercent || 0">
          </div>
        </div>
      </div>

      <!-- Stats -->
      <div class="subject-stats">
        <div class="stat">
          <span class="stat-icon">📖</span>
          <div class="stat-info">
            <span class="stat-value">{{ subject.totalChapters }}</span>
            <span class="stat-label">Chapitres</span>
          </div>
        </div>
        <div class="stat">
          <span class="stat-icon">❓</span>
          <div class="stat-info">
            <span class="stat-value">{{ subject.totalQuestions }}</span>
            <span class="stat-label">Questions</span>
          </div>
        </div>
      </div>

      <!-- Unlock Badges -->
      <div class="unlock-badges">
        <div
          *ngIf="subject.examUnlocked"
          class="unlock-badge exam unlocked clickable"
          (click)="navigateToExam(subject.id, $event)">
          <span class="badge-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="24" height="24">
              <circle cx="32" cy="32" r="30" fill="#4CAF50"/>
              <path d="M20 32l8 8 16-16" stroke="white" stroke-width="4" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <span class="badge-label">Mode Examen</span>
        </div>
        <div
          *ngIf="!subject.examUnlocked"
          class="unlock-badge exam">
          <span class="badge-icon">🔒</span>
          <span class="badge-label">Mode Examen</span>
        </div>
      </div>

      <!-- Action Button -->
      <div class="subject-action">
        <button class="btn-start" (click)="navigateToChapters(subject.id)">
          {{ subject.progressPercent > 0 ? 'Continuer' : 'Commencer' }}
          <span class="arrow">→</span>
        </button>
      </div>

    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && subjects.length === 0" class="empty-state">
    <p>Aucune matière disponible</p>
    <p class="hint">Les matières seront bientôt ajoutées!</p>
  </div>
</div>
